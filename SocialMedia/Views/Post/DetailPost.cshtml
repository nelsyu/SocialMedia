@using Service.ViewModels
@model (PostViewModel PostVM, ReplyViewModel ReplyVM)
@using Library.Extensions

<style>
    .username {
        width: 200px;
    }

    .title {
        width: 200px;
    }

    .content {
        width: 600px;
    }

    .post-date {
        width: 200px;
    }

    .edit-form {
        display: inline; /* 讓表單顯示為行內元素，使得按鈕在同一行 */
    }

    .reply-date {
        width: 200px;
    }
</style>

<h2>Post</h2>

<div class="container">
    <table class="table">
        <thead>
            <tr>
                <th scope="col" class="username">Username</th>
                <th scope="col" class="title">Title</th>
                <th scope="col" class="content">Content</th>
                <th scope="col" class="post-date">Post Date</th>
                <th scope="col">Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td class="username">@Model.PostVM.UserViewModel?.Username</td>
                <td class="title">@Model.PostVM.Title</td>
                <td class="content">@Model.PostVM.Content</td>
                <td class="post-date">@Model.PostVM.PostDate.ToString("yyyy-MM-dd HH:mm:ss")</td>
                <td>
                    @if (!string.IsNullOrEmpty(ViewContext.HttpContext.Session.GetObject<UserViewModel>("UserNowVM")?.Username) && Model.PostVM.UserViewModel?.Username == ViewContext.HttpContext.Session.GetObject<UserViewModel>("UserNowVM")?.Username)
                    {
                        <a class="btn btn-danger" href="@Url.Action("EditPost", "Post", new { postId = Model.PostVM.PostId })">Edit</a>
                    }
                </td>
            </tr>
        </tbody>
    </table>

    <!-- Reply Section -->
    <div class="container">
        <h3>Replies</h3>
        <table class="table">
            <thead>
                <tr>
                    <th scope="col" class="username">Username</th>
                    <th scope="col" class="content">Content</th>
                    <th scope="col" class="reply-date">Reply Date</th>
                    <!-- Add other properties as needed -->
                </tr>
            </thead>
            <tbody>
                @foreach (var reply in Model.PostVM.ReplyViewModels.OrderByDescending(rVM => rVM.ReplyDate))
                {
                    <tr>
                        <td class="username">@(reply.UserViewModel?.Username ?? "已刪除用戶")</td>
                        <td class="content">@reply.Content</td>
                        <td class="reply-date">@reply.ReplyDate.ToString("yyyy-MM-dd HH:mm:ss")</td>
                        <!-- Add other properties as needed -->
                    </tr>
                }
            </tbody>
        </table>
    </div>


    <table class="table">
        <tr>
            <td colspan="4">
                <form method="post" asp-controller="Post" asp-action="AddReply">
                    <input type="hidden" name="PostId" value="@Model.PostVM.PostId" />

                    <div class="form-group">
                        <label for="replyContent">Add Reply:</label>
                        <textarea class="form-control" id="replyContent" name="Content" rows="3" placeholder="Type your reply here..." required></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary">Submit Reply</button>
                </form>
            </td>
        </tr>
    </table>
</div>

