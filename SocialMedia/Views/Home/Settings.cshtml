@using Service.ViewModels
@model OTPViewModel
@{
    ViewData["Title"] = "Settings";
}

<h2>Settings</h2>

<p>Your settings content goes here.</p>

<!-- Button to trigger delete account modal -->
<button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
    Delete Account
</button>

<!-- Delete Account Modal -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <h5 class="modal-title" id="deleteAccountModalLabel">Confirm Delete Account</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">
                <p>Are you sure you want to delete your account? This action cannot be undone.</p>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form asp-controller="User" asp-action="DeleteAccount" method="post">
                    <button type="submit" class="btn btn-danger">Delete Account</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Button to trigger TOTP modal -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#totpModal">
    TOTP
</button>

<!-- TOTP Modal -->
<div class="modal fade" id="totpModal" tabindex="-1" aria-labelledby="totpModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <h5 class="modal-title" id="totpModalLabel">TOTP QRCode</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">
                <img src="data:image/png;base64,@Convert.ToBase64String(Model.OTPQRCode)" alt="TotpQRCode Image" style="max-width: 100%; height: auto;" />
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-danger" id="saveTOTPButton">已掃描，保存並啟用ORCode OTP</button>
                <form id="tOTPForm" asp-controller="User" asp-action="SaveQRCodeOTP" method="post">
                    <input type="hidden" name="QRCodeOTPSK" id="tOTPQRCodeInput" value="@Model.OTPQRCodeSK" />
                </form>

                <script>
                    // 使用 JavaScript 處理按鈕點擊事件
                    document.getElementById('saveTOTPButton').addEventListener('click', function () {
                        // 將 totpQRCode 放入隱藏的 input 中
                        document.getElementById('tOTPQRCodeInput').value = '@Model.OTPQRCodeSK';

                        // 手動提交表單
                        document.getElementById('tOTPForm').submit();
                    });
                </script>
            </div>

        </div>
    </div>
</div>
